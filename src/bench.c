#include "../inc/bench.h"
#include "../inc/SM2.h"
//#include "../inc/KDF.h"

#define TEST_TIMES 100

extern unsigned char SM2_p[32];
extern unsigned char SM2_a[32];
extern unsigned char SM2_b[32];

extern unsigned char SM2_Gx[32];
extern unsigned char SM2_Gy[32];

extern unsigned char SM2_n[32];
extern unsigned char one[32];

void bench_part()
{
	//the private key
	unsigned char
		dA[32] = { 0x12,0x8B,0x2F,0xA8 ,0xBD,0x43,0x3C,0x6C ,0x06,0x8C,0x8D,0x80 ,0x3D,0xFF,0x79,0x79 ,0x2A,0x51,0x9A,0x55 ,0x17,0x1B,0x1B,0x65 ,0x0C,0x23,0x66,0x1D ,0x15,0x89,0x72,0x63 };
	unsigned char
		k[32] = { 0x00,0x00,0x00,0x00,0x55,0x43,0x6C,0x71,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3D,0xFF,0x79,0x79,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07 };//k
	unsigned char
		add[32] = { 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x32,0xFF,0x79,0x79,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0B };//add
	unsigned char
		rand[32] = { 0x6C,0xB2,0x8D,0x99,0x38,0x5C,0x17,0x5C,0x94,0xF9,0x4E,0x93,0x48,0x17,0x66,0x3F,0xC1,0x76,0xD9,0x25,0xDD,0x72,0xB7,0x27,0x26,0x0D,0xBA,0xAE,0x1F,0xB2,0xF9,0x6F };
	//the public key
	unsigned char
		xA[32] = { 0x0A,0xE4,0xC7,0x79 ,0x8A,0xA0,0xF1,0x19 ,0x47,0x1B,0xEE,0x11 ,0x82,0x5B,0xE4,0x62,0x02,0xBB,0x79,0xE2 ,0xA5,0x84,0x44,0x95 ,0xE9,0x7C,0x04,0xFF ,0x4D,0xF2,0x54,0x8A };
	unsigned char
		yA[32] = { 0x7C,0x02,0x40,0xF8 ,0x8F,0x1C,0xD4,0xE1 ,0x63,0x52,0xA7,0x3C ,0x17,0xB7,0xF1,0x6F ,0x07,0x35,0x3E,0x53 ,0xA1,0x76,0xD6,0x84 ,0xA9,0xFE,0x0C,0x6B ,0xB7,0x98,0xE8,0x57 };
	/*unsigned char xA[32], yA[32];*/
	unsigned char r[32], s[32], s2[32];// Signature

	unsigned char IDA[18] = { 0x41,0x4C ,0x49,0x43,0x45,0x31 ,0x32,0x33,0x40,0x59 ,0x41,0x48,0x4F,0x4F ,0x2E,0x43,0x4F,0x4D };//ASCII code of userA's identification
	int IDA_len = 16;
	unsigned char ENTLA[2] = { 0x00,0x90 };//the length of userA's identification,presentation in ASCII code
	unsigned char* message = "message digest";//the message to be signed
	unsigned char* message2 = "happy";
	int len = strlen(message);//the length of message
	int len2 = strlen(message2);

	unsigned char ZA[32];//ZA=Hash(ENTLA| | IDA| | a| | b| | Gx || Gy || xA| | yA) 
	unsigned char Msg[210]; //210=IDA_len+2+SM2_NUMWORD*6
	int temp;

	miracl* mip = mirsys(10000, 16);
	mip->IOBASE = 16;

	/*temp = SM2_KeyGeneration(dA, xA, yA);
	if (temp)
		return temp;*/

	// ENTLA| | IDA| | a| | b| | Gx || Gy || xA| | yA
	memcpy(Msg, ENTLA, 2);
	memcpy(Msg + 2, IDA, IDA_len);
	memcpy(Msg + 2 + IDA_len, SM2_a, SM2_NUMWORD);
	memcpy(Msg + 2 + IDA_len + SM2_NUMWORD, SM2_b, SM2_NUMWORD);
	memcpy(Msg + 2 + IDA_len + SM2_NUMWORD * 2, SM2_Gx, SM2_NUMWORD);
	memcpy(Msg + 2 + IDA_len + SM2_NUMWORD * 3, SM2_Gy, SM2_NUMWORD);
	memcpy(Msg + 2 + IDA_len + SM2_NUMWORD * 4, xA, SM2_NUMWORD);
	memcpy(Msg + 2 + IDA_len + SM2_NUMWORD * 5, yA, SM2_NUMWORD);
	SM3_256(Msg, 210, ZA);

	//temp = SM2_Sign(message, len, ZA, rand, dA, r, s);
	//if (temp)
	//	return temp;//if tmp!=0,return tmp

	//temp = SM2_Verify(message, len, ZA, xA, yA, r, s);
	//if (temp)
	//	return temp;

	printf("\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> bench arith part <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<\n");
	
	int testtime = 10;
	
	
	bench_function(testtime, "KeyGen", DAP_SM2_KeyGeneration(dA, rand, xA, k, yA, add));//test SM2-KeyGen
	//bench_function(testtime, "Sign", SM2_Sign(message, len, ZA, rand, dA, r, s));//test SM2-Sign
	//bench_function(testtime, "Verify", SM2_Verify(message, len, ZA, xA, yA, r, s));//test SM2-Verify
	//bench_function(testtime, "Extract", DAP_SM2_Extract(message, message2, s, s2, len, len2, rand, ZA));//test Extract

	mip = mirsys(100, 16);
	mip->IOBASE = 16;
	
	mip->TWIST = MR_SEXTIC_M;

	//MR_PROJECTIVE specifying projective coordinates
	
}


